<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Formatação de Data</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-case {
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .pass {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        .fail {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        h1 {
            color: #333;
        }
        .result {
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Teste de Formatação de Data - Correção do Bug "-1 dia"</h1>
    <div id="test-results"></div>

    <script type="module">
        // Importar a função formatDate do helpers.js
        import { formatDate } from './js/utils/helpers.js';

        const testCases = [
            {
                name: 'Data ISO: 2026-01-11 (caso do problema)',
                input: '2026-01-11',
                expected: '11/01/2026',
                description: 'Deve exibir 11/01/2026, não 10/01/2026'
            },
            {
                name: 'Data ISO com hora: 2026-01-11T10:30:00',
                input: '2026-01-11T10:30:00',
                expected: '11/01/2026',
                description: 'Deve ignorar hora e exibir apenas a data'
            },
            {
                name: 'Data brasileira: 11/01/2026',
                input: '11/01/2026',
                expected: '11/01/2026',
                description: 'Deve manter formato brasileiro'
            },
            {
                name: 'Data ISO: 2025-12-31',
                input: '2025-12-31',
                expected: '31/12/2025',
                description: 'Teste com último dia do ano'
            },
            {
                name: 'Data ISO: 2026-02-29 (ano bissexto)',
                input: '2026-02-29',
                expected: '29/02/2026',
                description: 'Teste com data de ano bissexto'
            },
            {
                name: 'Objeto Date criado localmente',
                input: (() => {
                    // Criar Date local (não UTC) para 11/01/2026
                    return new Date(2026, 0, 11); // mês 0 = janeiro
                })(),
                expected: '11/01/2026',
                description: 'Date object local deve manter data correta'
            }
        ];

        function runTests() {
            const resultsDiv = document.getElementById('test-results');
            let passCount = 0;
            let failCount = 0;

            testCases.forEach((testCase, index) => {
                const result = formatDate(testCase.input);
                const passed = result === testCase.expected;
                
                if (passed) {
                    passCount++;
                } else {
                    failCount++;
                }

                const testDiv = document.createElement('div');
                testDiv.className = `test-case ${passed ? 'pass' : 'fail'}`;
                testDiv.innerHTML = `
                    <strong>Teste ${index + 1}: ${testCase.name}</strong><br>
                    <small>${testCase.description}</small><br>
                    <strong>Entrada:</strong> ${JSON.stringify(testCase.input)}<br>
                    <strong>Esperado:</strong> ${testCase.expected}<br>
                    <strong>Resultado:</strong> ${result}<br>
                    <div class="result">${passed ? '✅ PASSOU' : '❌ FALHOU'}</div>
                `;
                resultsDiv.appendChild(testDiv);
            });

            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-case ${failCount === 0 ? 'pass' : 'fail'}`;
            summaryDiv.style.marginTop = '20px';
            summaryDiv.innerHTML = `
                <strong>Resumo dos Testes</strong><br>
                Total: ${testCases.length}<br>
                ✅ Passou: ${passCount}<br>
                ❌ Falhou: ${failCount}<br>
                <div class="result">${failCount === 0 ? '✅ TODOS OS TESTES PASSARAM!' : '❌ ALGUNS TESTES FALHARAM'}</div>
            `;
            resultsDiv.appendChild(summaryDiv);
        }

        // Executar testes quando a página carregar
        runTests();
    </script>
</body>
</html>
